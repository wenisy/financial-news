<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文章分析测试</title>
  <style>
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #1a73e8;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 15px;
      font-size: 14px;
    }
    textarea {
      min-height: 150px;
    }
    button {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    button:hover {
      background: #0d62c9;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      border-left: 4px solid #1a73e8;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .error {
      color: #c5221f;
      background: #fce8e6;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    .tab.active {
      border-bottom-color: #1a73e8;
      color: #1a73e8;
      font-weight: bold;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1>文章分析测试</h1>
  
  <div class="tabs">
    <div class="tab active" data-tab="content">获取文章内容</div>
    <div class="tab" data-tab="analyze">分析文章</div>
  </div>
  
  <div class="tab-content active" id="content-tab">
    <div class="card">
      <h2>获取文章内容</h2>
      <p>输入文章URL，获取文章内容</p>
      
      <form id="contentForm">
        <div>
          <label for="contentUrl">文章URL</label>
          <input type="url" id="contentUrl" placeholder="https://example.com/article" required>
        </div>
        
        <button type="submit" id="fetchBtn">获取内容</button>
      </form>
      
      <div id="contentResult" class="result" style="display: none;"></div>
      <div id="contentError" class="error" style="display: none;"></div>
    </div>
  </div>
  
  <div class="tab-content" id="analyze-tab">
    <div class="card">
      <h2>分析文章</h2>
      <p>输入文章URL和股票信息，分析文章内容</p>
      
      <form id="analyzeForm">
        <div>
          <label for="analyzeUrl">文章URL</label>
          <input type="url" id="analyzeUrl" placeholder="https://example.com/article" required>
        </div>
        
        <div>
          <label for="symbol">股票代码</label>
          <input type="text" id="symbol" placeholder="AAPL" required>
        </div>
        
        <div>
          <label for="stockName">公司名称</label>
          <input type="text" id="stockName" placeholder="Apple Inc." required>
        </div>
        
        <button type="submit" id="analyzeBtn">分析文章</button>
      </form>
      
      <div id="analyzeResult" class="result" style="display: none;"></div>
      <div id="analyzeError" class="error" style="display: none;"></div>
    </div>
  </div>
  
  <script>
    // 标签切换
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        // 移除所有活动标签
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // 激活当前标签
        this.classList.add('active');
        document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
      });
    });
    
    // 获取内容表单
    document.getElementById('contentForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const fetchBtn = document.getElementById('fetchBtn');
      const contentResult = document.getElementById('contentResult');
      const contentError = document.getElementById('contentError');
      
      // 获取URL
      const url = document.getElementById('contentUrl').value;
      
      // 显示加载状态
      fetchBtn.disabled = true;
      fetchBtn.innerHTML = '获取中 <span class="loading"></span>';
      contentResult.style.display = 'none';
      contentError.style.display = 'none';
      
      try {
        // 调用API
        const response = await fetch('/api/articles/content', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ url })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.message || '获取内容失败');
        }
        
        // 显示结果
        contentResult.textContent = `标题: ${data.data.title}\n\n来源: ${data.data.source}\n\n发布日期: ${new Date(data.data.publishDate).toLocaleString()}\n\n内容预览:\n${data.data.contentPreview}\n\n总字数: ${data.data.contentLength}`;
        contentResult.style.display = 'block';
      } catch (error) {
        console.error('获取内容失败:', error);
        contentError.textContent = `获取内容失败: ${error.message}`;
        contentError.style.display = 'block';
      } finally {
        // 恢复按钮状态
        fetchBtn.disabled = false;
        fetchBtn.textContent = '获取内容';
      }
    });
    
    // 分析文章表单
    document.getElementById('analyzeForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const analyzeBtn = document.getElementById('analyzeBtn');
      const analyzeResult = document.getElementById('analyzeResult');
      const analyzeError = document.getElementById('analyzeError');
      
      // 获取表单数据
      const url = document.getElementById('analyzeUrl').value;
      const symbol = document.getElementById('symbol').value;
      const name = document.getElementById('stockName').value;
      
      // 显示加载状态
      analyzeBtn.disabled = true;
      analyzeBtn.innerHTML = '分析中 <span class="loading"></span>';
      analyzeResult.style.display = 'none';
      analyzeError.style.display = 'none';
      
      try {
        // 调用API
        const response = await fetch('/api/articles/analyze', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            url,
            stock: { symbol, name }
          })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.message || '分析失败');
        }
        
        // 显示结果
        analyzeResult.textContent = `分析请求已提交\n\n请求详情:\n${JSON.stringify(data, null, 2)}`;
        analyzeResult.style.display = 'block';
      } catch (error) {
        console.error('分析失败:', error);
        analyzeError.textContent = `分析失败: ${error.message}`;
        analyzeError.style.display = 'block';
      } finally {
        // 恢复按钮状态
        analyzeBtn.disabled = false;
        analyzeBtn.textContent = '分析文章';
      }
    });
  </script>
</body>
</html>
